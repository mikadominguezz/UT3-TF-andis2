
'use strict'
var url = require('url')
var parse = url.parse
var Url = url.Url
module.exports = parseurl
module.exports.original = originalurl
function parseurl (req) {
  var url = req.url

  if (url === undefined) {

    return undefined
  }

  var parsed = req._parsedUrl

  if (fresh(url, parsed)) {

    return parsed
  }

  
  parsed = fastparse(url)
  parsed._raw = url

  return (req._parsedUrl = parsed)
};
function originalurl (req) {
  var url = req.originalUrl

  if (typeof url !== 'string') {

    return parseurl(req)
  }

  var parsed = req._parsedOriginalUrl

  if (fresh(url, parsed)) {

    return parsed
  }

  
  parsed = fastparse(url)
  parsed._raw = url

  return (req._parsedOriginalUrl = parsed)
};
function fastparse (str) {
        if (search === null) {
          pathname = str.substring(0, i)
          query = str.substring(i + 1)
          search = str.substring(i)
        }
        break
      case 0xa0:
      case 0xfeff:
        return parse(str)
    }
  }

  var url = Url !== undefined
    ? new Url()
    : {}

  url.path = str
  url.href = str
  url.pathname = pathname

  if (search !== null) {
    url.query = query
    url.search = search
  }

  return url
}
function fresh (url, parsedUrl) {
  return typeof parsedUrl === 'object' &&
    parsedUrl !== null &&
    (Url === undefined || parsedUrl instanceof Url) &&
    parsedUrl._raw === url
}
