<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TechMart - E-Commerce</title>
<link rel="stylesheet" href="style.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
  <!-- Navigation Bar -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo">
        <i class="fas fa-shopping-cart"></i>
        <span>TechMart</span>
      </div>
      <div class="nav-links">
        <a href="#" onclick="showSection('products')">Productos</a>
        <a href="#" onclick="showSection('cart')">Carrito (<span id="cart-count">0</span>)</a>
        <a href="#" onclick="showSection('orders')">Mis Órdenes</a>
        <a href="#" onclick="showSection('admin')" id="admin-link" style="display:none">Admin</a>
      </div>
      <div class="nav-auth">
        <div id="auth-section">
          <button onclick="showLoginModal()" class="btn-primary">Iniciar Sesión</button>
        </div>
        <div id="user-section" style="display:none">
          <span>Bienvenido, <span id="username-display"></span></span>
          <button onclick="logout()" class="btn-secondary">Cerrar Sesión</button>
        </div>
      </div>
    </div>
  </nav>

  <!-- Login Modal -->
  <div id="login-modal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeLoginModal()">&times;</span>
      <h2>Iniciar Sesión</h2>
      <div class="login-options">
        <div class="login-option">
          <h3>Cliente</h3>
          <p>Usuario: alice | Password: alicepass</p>
          <button onclick="quickLogin('alice', 'alicepass')" class="btn-primary">Entrar como Cliente</button>
        </div>
        <div class="login-option">
          <h3>Administrador</h3>
          <p>Usuario: bob | Password: bobpass</p>
          <button onclick="quickLogin('bob', 'bobpass')" class="btn-admin">Entrar como Admin</button>
        </div>
      </div>
      <div class="manual-login">
        <h3>Login Manual</h3>
        <input type="text" id="username" placeholder="Usuario">
        <input type="password" id="password" placeholder="Contraseña">
        <button onclick="login()" class="btn-primary">Ingresar</button>
      </div>
      <div id="login-result"></div>
    </div>
  </div>

  <!-- Main Content -->
  <main class="container">
    
    <!-- Products Section -->
    <section id="products-section" class="section active">
      <div class="section-header">
        <h2><i class="fas fa-box"></i> Catálogo de Productos</h2>
        <div class="search-bar">
          <input type="text" id="search-products" placeholder="Buscar productos...">
          <button onclick="searchProducts()"><i class="fas fa-search"></i></button>
        </div>
      </div>
      
      <div class="products-grid" id="products-grid">
        <!-- Products will be loaded here -->
      </div>
      
      <div class="loading" id="products-loading" style="display:none">
        <i class="fas fa-spinner fa-spin"></i> Cargando productos...
      </div>
    </section>

    <!-- Shopping Cart Section -->
    <section id="cart-section" class="section">
      <div class="section-header">
        <h2><i class="fas fa-shopping-cart"></i> Carrito de Compras</h2>
        <button onclick="clearCart()" class="btn-secondary">Vaciar Carrito</button>
      </div>
      
      <div id="cart-items" class="cart-items">
        <!-- Cart items will be loaded here -->
      </div>
      
      <div class="cart-summary">
        <div class="cart-total">
          <strong>Total: $<span id="cart-total">0.00</span></strong>
        </div>
        <button onclick="checkout()" class="btn-primary btn-large" id="checkout-btn" disabled>
          <i class="fas fa-credit-card"></i> Proceder al Pago
        </button>
      </div>
    </section>

    <!-- Orders Section -->
    <section id="orders-section" class="section">
      <div class="section-header">
        <h2><i class="fas fa-receipt"></i> Mis Órdenes</h2>
        <button onclick="loadOrders()" class="btn-primary">Actualizar</button>
      </div>
      
      <div id="orders-list" class="orders-list">
        <!-- Orders will be loaded here -->
      </div>
      
      <div class="loading" id="orders-loading" style="display:none">
        <i class="fas fa-spinner fa-spin"></i> Cargando órdenes...
      </div>
    </section>

    <!-- Admin Section -->
    <section id="admin-section" class="section">
      <div class="section-header">
        <h2><i class="fas fa-cog"></i> Panel de Administración</h2>
      </div>
      
      <div class="admin-tabs">
        <button class="tab-button active" onclick="showAdminTab('products')">Gestionar Productos</button>
        <button class="tab-button" onclick="showAdminTab('clients')">Gestionar Clientes</button>
        <button class="tab-button" onclick="showAdminTab('orders')">Ver Todas las Órdenes</button>
        <button class="tab-button" onclick="showAdminTab('stats')">Estadísticas</button>
      </div>
      
      <!-- Admin Products Tab -->
      <div id="admin-products" class="admin-tab active">
        <div class="admin-form">
          <h3>Agregar/Editar Producto</h3>
          <input type="hidden" id="edit-product-id">
          <input type="text" id="admin-product-name" placeholder="Nombre del producto">
          <input type="number" id="admin-product-price" placeholder="Precio" step="0.01">
          <textarea id="admin-product-description" placeholder="Descripción del producto"></textarea>
          <input type="text" id="admin-product-category" placeholder="Categoría">
          <button onclick="saveProduct()" class="btn-admin">Guardar Producto</button>
          <button onclick="clearProductForm()" class="btn-secondary">Limpiar</button>
        </div>
        
        <div class="admin-table">
          <h3>Productos Existentes</h3>
          <div id="admin-products-list"></div>
        </div>
      </div>
      
      <!-- Admin Clients Tab -->
      <div id="admin-clients" class="admin-tab">
        <div class="admin-form">
          <h3>Agregar Cliente</h3>
          <input type="text" id="admin-client-name" placeholder="Nombre del cliente">
          <input type="email" id="admin-client-email" placeholder="Email del cliente">
          <button onclick="saveClient()" class="btn-admin">Agregar Cliente</button>
        </div>
        
        <div class="admin-table">
          <h3>Clientes Registrados</h3>
          <div id="admin-clients-list"></div>
        </div>
      </div>
      
      <!-- Admin Orders Tab -->
      <div id="admin-orders" class="admin-tab">
        <div class="admin-table">
          <h3>Todas las Órdenes</h3>
          <div id="admin-orders-list"></div>
        </div>
      </div>
      
      <!-- Admin Stats Tab -->
      <div id="admin-stats" class="admin-tab">
        <div class="stats-grid">
          <div class="stat-card">
            <h3>Total Productos</h3>
            <div class="stat-number" id="stat-products">0</div>
          </div>
          <div class="stat-card">
            <h3>Total Clientes</h3>
            <div class="stat-number" id="stat-clients">0</div>
          </div>
          <div class="stat-card">
            <h3>Total Órdenes</h3>
            <div class="stat-number" id="stat-orders">0</div>
          </div>
          <div class="stat-card">
            <h3>Ventas Totales</h3>
            <div class="stat-number">$<span id="stat-sales">0.00</span></div>
          </div>
        </div>
      </div>
    </section>

  </main>

  
  <!-- Success/Error Messages -->
  <div id="message" class="message"></div>

  <script>
    const API_BASE = 'http://localhost:8080/api';
    let currentToken = '';
    let currentUser = null;
    let cart = [];
    let products = [];

    // Initialize the app
    document.addEventListener('DOMContentLoaded', function() {
      loadProducts();
      updateCartDisplay();
      showSection('products');
    });

    // Navigation Functions
    function showSection(sectionName) {
      document.querySelectorAll('.section').forEach(section => {
        section.classList.remove('active');
      });
      
      document.getElementById(sectionName + '-section').classList.add('active');
      
      if (sectionName === 'orders' && currentUser) {
        loadOrders();
      } else if (sectionName === 'admin' && currentUser && currentUser.roles.includes('admin')) {
        loadAdminData();
      }
    }

    // Authentication Functions
    function showLoginModal() {
      document.getElementById('login-modal').style.display = 'block';
    }

    function closeLoginModal() {
      document.getElementById('login-modal').style.display = 'none';
    }

    async function quickLogin(username, password) {
      document.getElementById('username').value = username;
      document.getElementById('password').value = password;
      await login();
    }

    async function login() {
      const username = document.getElementById('username').value;
      const password = document.getElementById('password').value;
      
      if (!username || !password) {
        showMessage('Por favor ingrese usuario y contraseña', 'error');
        return;
      }

      try {
        const response = await fetch(`${API_BASE}/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const data = await response.json();
        
        if (response.ok) {
          currentToken = data.token;
          currentUser = data.user;
          
          // Update UI
          document.getElementById('auth-section').style.display = 'none';
          document.getElementById('user-section').style.display = 'block';
          document.getElementById('username-display').textContent = currentUser.username;
          
          // Show/hide admin link
          if (currentUser.roles.includes('admin')) {
            document.getElementById('admin-link').style.display = 'block';
          }
          
          closeLoginModal();
          showMessage(`Bienvenido, ${currentUser.username}!`, 'success');
          
          // Clear form
          document.getElementById('username').value = '';
          document.getElementById('password').value = '';
        } else {
          showMessage(data.error || 'Error de login', 'error');
        }
      } catch (error) {
        showMessage('Error de conexión', 'error');
      }
    }

    function logout() {
      currentToken = '';
      currentUser = null;
      cart = [];
      
      // Update UI
      document.getElementById('auth-section').style.display = 'block';
      document.getElementById('user-section').style.display = 'none';
      document.getElementById('admin-link').style.display = 'none';
      
      updateCartDisplay();
      showSection('products');
      showMessage('Sesión cerrada', 'info');
    }

    // Products Functions
    async function loadProducts() {
      document.getElementById('products-loading').style.display = 'block';
      
      try {
        const response = await fetch(`${API_BASE}/api/products`);
        const data = await response.json();
        
        if (response.ok) {
          products = data;
          displayProducts(products);
        } else {
          showMessage('Error cargando productos', 'error');
        }
      } catch (error) {
        showMessage('Error de conexión al cargar productos', 'error');
      } finally {
        document.getElementById('products-loading').style.display = 'none';
      }
    }

    function displayProducts(productList) {
      const grid = document.getElementById('products-grid');
      
      if (productList.length === 0) {
        grid.innerHTML = '<div class="no-products">No hay productos disponibles</div>';
        return;
      }
      
      grid.innerHTML = productList.map(product => `
        <div class="product-card">
          <div class="product-image">
            <i class="fas fa-box"></i>
          </div>
          <div class="product-info">
            <h3 class="product-name">${product.name}</h3>
            <p class="product-description">${product.description || 'Sin descripción'}</p>
            <p class="product-category">${product.category || 'General'}</p>
            <div class="product-price">$${product.price}</div>
          </div>
          <div class="product-actions">
            <button onclick="addToCart(${product.id})" class="btn-primary">
              <i class="fas fa-cart-plus"></i> Agregar al Carrito
            </button>
          </div>
        </div>
      `).join('');
    }

    function searchProducts() {
      const searchTerm = document.getElementById('search-products').value.toLowerCase();
      
      if (!searchTerm) {
        displayProducts(products);
        return;
      }
      
      const filtered = products.filter(product => 
        product.name.toLowerCase().includes(searchTerm) ||
        (product.description && product.description.toLowerCase().includes(searchTerm)) ||
        (product.category && product.category.toLowerCase().includes(searchTerm))
      );
      
      displayProducts(filtered);
    }

    // Cart Functions
    function addToCart(productId) {
      if (!currentUser) {
        showMessage('Debe iniciar sesión para agregar productos al carrito', 'error');
        showLoginModal();
        return;
      }
      
      const product = products.find(p => p.id == productId);
      if (!product) return;
      
      const existingItem = cart.find(item => item.id == productId);
      
      if (existingItem) {
        existingItem.quantity += 1;
      } else {
        cart.push({ ...product, quantity: 1 });
      }
      
      updateCartDisplay();
      showMessage(`${product.name} agregado al carrito`, 'success');
    }

    function removeFromCart(productId) {
      cart = cart.filter(item => item.id != productId);
      updateCartDisplay();
    }

    function updateQuantity(productId, quantity) {
      const item = cart.find(item => item.id == productId);
      if (item) {
        item.quantity = Math.max(1, quantity);
        updateCartDisplay();
      }
    }

    function clearCart() {
      cart = [];
      updateCartDisplay();
      showMessage('Carrito vaciado', 'info');
    }

    function updateCartDisplay() {
      const cartCount = document.getElementById('cart-count');
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      const checkoutBtn = document.getElementById('checkout-btn');
      
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      cartCount.textContent = totalItems;
      cartTotal.textContent = totalPrice.toFixed(2);
      
      if (cart.length === 0) {
        cartItems.innerHTML = '<div class="empty-cart">El carrito está vacío</div>';
        checkoutBtn.disabled = true;
      } else {
        cartItems.innerHTML = cart.map(item => `
          <div class="cart-item">
            <div class="cart-item-info">
              <h3>${item.name}</h3>
              <p>$${item.price} c/u</p>
            </div>
            <div class="cart-item-controls">
              <button onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
              <span class="quantity">${item.quantity}</span>
              <button onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
            </div>
            <div class="cart-item-total">
              $${(item.price * item.quantity).toFixed(2)}
            </div>
            <button onclick="removeFromCart(${item.id})" class="btn-remove">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `).join('');
        checkoutBtn.disabled = false;
      }
    }

    async function checkout() {
      if (!currentUser) {
        showMessage('Debe iniciar sesión', 'error');
        return;
      }
      
      if (cart.length === 0) {
        showMessage('El carrito está vacío', 'error');
        return;
      }
      
      if (currentUser.roles.includes('admin')) {
        showMessage('Los administradores no pueden realizar compras', 'error');
        return;
      }
      
      try {
        const productIds = cart.map(item => item.id);
        
        const response = await fetch(`${API_BASE}/api/orders`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify({
            clientId: currentUser.id,
            productIds: productIds
          })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showMessage('¡Orden creada exitosamente!', 'success');
          cart = [];
          updateCartDisplay();
          showSection('orders');
        } else {
          showMessage(data.error || 'Error al crear la orden', 'error');
        }
      } catch (error) {
        showMessage('Error de conexión', 'error');
      }
    }

    // Orders Functions
    async function loadOrders() {
      if (!currentUser) return;
      
      document.getElementById('orders-loading').style.display = 'block';
      
      try {
        const response = await fetch(`${API_BASE}/api/orders`, {
          headers: { 'Authorization': `Bearer ${currentToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          displayOrders(data);
        } else {
          showMessage('Error cargando órdenes', 'error');
        }
      } catch (error) {
        showMessage('Error de conexión', 'error');
      } finally {
        document.getElementById('orders-loading').style.display = 'none';
      }
    }

    function displayOrders(orders) {
      const ordersList = document.getElementById('orders-list');
      
      if (orders.length === 0) {
        ordersList.innerHTML = '<div class="no-orders">No tienes órdenes registradas</div>';
        return;
      }
      
      ordersList.innerHTML = orders.map(order => `
        <div class="order-card">
          <div class="order-header">
            <h3>Orden #${order.id}</h3>
            <span class="order-date">${new Date(order.createdAt).toLocaleDateString()}</span>
          </div>
          <div class="order-details">
            <p><strong>Cliente:</strong> ${order.clientId}</p>
            <p><strong>Productos:</strong> ${order.productIds.join(', ')}</p>
            <p><strong>Total:</strong> $${order.total || '0.00'}</p>
            <p><strong>Estado:</strong> <span class="order-status">${order.status || 'Pendiente'}</span></p>
          </div>
        </div>
      `).join('');
    }

    // Admin Functions
    function showAdminTab(tabName) {
      if (!currentUser || !currentUser.roles.includes('admin')) {
        showMessage('Acceso denegado', 'error');
        return;
      }
      
      document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
      document.querySelectorAll('.admin-tab').forEach(tab => tab.classList.remove('active'));
      
      event.target.classList.add('active');
      document.getElementById('admin-' + tabName).classList.add('active');
      
      if (tabName === 'products') {
        loadAdminProducts();
      } else if (tabName === 'clients') {
        loadAdminClients();
      } else if (tabName === 'orders') {
        loadAdminOrders();
      } else if (tabName === 'stats') {
        loadAdminStats();
      }
    }

    async function loadAdminData() {
      if (!currentUser || !currentUser.roles.includes('admin')) return;
      
      await loadAdminProducts();
      await loadAdminClients();
      await loadAdminOrders();
      await loadAdminStats();
    }

    async function loadAdminProducts() {
      try {
        const response = await fetch(`${API_BASE}/api/products`, {
          headers: { 'Authorization': `Bearer ${currentToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          displayAdminProducts(data);
        }
      } catch (error) {
        console.error('Error loading admin products:', error);
      }
    }

    function displayAdminProducts(products) {
      const list = document.getElementById('admin-products-list');
      
      list.innerHTML = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Precio</th>
              <th>Categoría</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            ${products.map(product => `
              <tr>
                <td>${product.id}</td>
                <td>${product.name}</td>
                <td>$${product.price}</td>
                <td>${product.category || 'N/A'}</td>
                <td>
                  <button onclick="editProduct(${product.id})" class="btn-small">Editar</button>
                  <button onclick="deleteProduct(${product.id})" class="btn-small btn-danger">Eliminar</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    async function saveProduct() {
      if (!currentUser || !currentUser.roles.includes('admin')) {
        showMessage('Acceso denegado', 'error');
        return;
      }
      
      const name = document.getElementById('admin-product-name').value;
      const price = parseFloat(document.getElementById('admin-product-price').value);
      const description = document.getElementById('admin-product-description').value;
      const category = document.getElementById('admin-product-category').value;
      const editId = document.getElementById('edit-product-id').value;
      
      if (!name || !price) {
        showMessage('Nombre y precio son requeridos', 'error');
        return;
      }
      
      const productData = { name, price, description, category };
      
      try {
        const url = editId ? `${API_BASE}/api/products/${editId}` : `${API_BASE}/api/products`;
        const method = editId ? 'PUT' : 'POST';
        
        const response = await fetch(url, {
          method: method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify(productData)
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showMessage(editId ? 'Producto actualizado' : 'Producto creado', 'success');
          clearProductForm();
          loadAdminProducts();
          loadProducts();
        } else {
          showMessage(data.error || 'Error al guardar producto', 'error');
        }
      } catch (error) {
        showMessage('Error de conexión', 'error');
      }
    }

    function editProduct(id) {
      const product = products.find(p => p.id == id);
      if (!product) return;
      
      document.getElementById('edit-product-id').value = id;
      document.getElementById('admin-product-name').value = product.name;
      document.getElementById('admin-product-price').value = product.price;
      document.getElementById('admin-product-description').value = product.description || '';
      document.getElementById('admin-product-category').value = product.category || '';
    }

    function clearProductForm() {
      document.getElementById('edit-product-id').value = '';
      document.getElementById('admin-product-name').value = '';
      document.getElementById('admin-product-price').value = '';
      document.getElementById('admin-product-description').value = '';
      document.getElementById('admin-product-category').value = '';
    }

    async function deleteProduct(id) {
      if (!confirm('¿Está seguro de eliminar este producto?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/api/products/${id}`, {
          method: 'DELETE',
          headers: { 'Authorization': `Bearer ${currentToken}` }
        });
        
        if (response.ok) {
          showMessage('Producto eliminado', 'success');
          loadAdminProducts();
          loadProducts();
        } else {
          showMessage('Error al eliminar producto', 'error');
        }
      } catch (error) {
        showMessage('Error de conexión', 'error');
      }
    }

    async function loadAdminClients() {
      try {
        const response = await fetch(`${API_BASE}/api/admin/clients`, {
          headers: { 'Authorization': `Bearer ${currentToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          displayAdminClients(data);
        }
      } catch (error) {
        console.error('Error loading admin clients:', error);
      }
    }

    function displayAdminClients(clients) {
      const list = document.getElementById('admin-clients-list');
      
      list.innerHTML = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Fecha Registro</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            ${clients.map(client => `
              <tr>
                <td>${client.id}</td>
                <td>${client.name}</td>
                <td>${client.email || 'N/A'}</td>
                <td>${client.createdAt ? new Date(client.createdAt).toLocaleDateString() : 'N/A'}</td>
                <td>
                  <button onclick="deleteClient(${client.id})" class="btn-small btn-danger">Eliminar</button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    async function saveClient() {
      if (!currentUser || !currentUser.roles.includes('admin')) {
        showMessage('Acceso denegado', 'error');
        return;
      }
      
      const name = document.getElementById('admin-client-name').value;
      const email = document.getElementById('admin-client-email').value;
      
      if (!name) {
        showMessage('El nombre es requerido', 'error');
        return;
      }
      
      try {
        const response = await fetch(`${API_BASE}/api/admin/clients`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${currentToken}`
          },
          body: JSON.stringify({ name, email })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          showMessage('Cliente creado exitosamente', 'success');
          document.getElementById('admin-client-name').value = '';
          document.getElementById('admin-client-email').value = '';
          loadAdminClients();
        } else {
          showMessage(data.error || 'Error al crear cliente', 'error');
        }
      } catch (error) {
        showMessage('Error de conexión', 'error');
      }
    }

    async function loadAdminOrders() {
      try {
        const response = await fetch(`${API_BASE}/api/admin/orders`, {
          headers: { 'Authorization': `Bearer ${currentToken}` }
        });
        
        const data = await response.json();
        
        if (response.ok) {
          displayAdminOrders(data);
        }
      } catch (error) {
        console.error('Error loading admin orders:', error);
      }
    }

    function displayAdminOrders(orders) {
      const list = document.getElementById('admin-orders-list');
      
      if (orders.length === 0) {
        list.innerHTML = '<div class="no-data">No hay órdenes registradas</div>';
        return;
      }
      
      list.innerHTML = `
        <table class="admin-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Cliente</th>
              <th>Productos</th>
              <th>Total</th>
              <th>Fecha</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            ${orders.map(order => `
              <tr>
                <td>${order.id}</td>
                <td>${order.clientId}</td>
                <td>${order.productIds.join(', ')}</td>
                <td>$${order.total || '0.00'}</td>
                <td>${order.createdAt ? new Date(order.createdAt).toLocaleDateString() : 'N/A'}</td>
                <td><span class="order-status">${order.status || 'Pendiente'}</span></td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;
    }

    async function loadAdminStats() {
      try {
        const [productsRes, clientsRes, ordersRes] = await Promise.all([
          fetch(`${API_BASE}/api/products`),
          fetch(`${API_BASE}/api/admin/clients`, { headers: { 'Authorization': `Bearer ${currentToken}` } }),
          fetch(`${API_BASE}/api/admin/orders`, { headers: { 'Authorization': `Bearer ${currentToken}` } })
        ]);
        
        const products = await productsRes.json();
        const clients = await clientsRes.json();
        const orders = await ordersRes.json();
        
        document.getElementById('stat-products').textContent = products.length || 0;
        document.getElementById('stat-clients').textContent = clients.length || 0;
        document.getElementById('stat-orders').textContent = orders.length || 0;
        
        const totalSales = orders.reduce((sum, order) => sum + (parseFloat(order.total) || 0), 0);
        document.getElementById('stat-sales').textContent = totalSales.toFixed(2);
        
      } catch (error) {
        console.error('Error loading admin stats:', error);
      }
    }

    // Utility Functions
    function showMessage(text, type = 'info') {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = text;
      messageDiv.className = `message ${type} show`;
      
      setTimeout(() => {
        messageDiv.classList.remove('show');
      }, 3000);
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('login-modal');
      if (event.target === modal) {
        closeLoginModal();
      }
    }
  </script>
</body>
</html>

